{% extends "base.html" %}
{% block title %}{{experiment.name}} Experiment{% endblock %}
{% block head %}
    {{ super() }}
    <script type="text/javascript">
    	/* <![CDATA[ */
    	function perc(nom, denom) { // nom nom nom
			if (denom == 0) return 0;
    		return nom / denom * 100.0;
    	}
    	
    	$(document).ready(function() {
			$.ajax({
			    url: "{{url_for('frontend.experiment_stats_ajax', database=database, experiment_id=experiment.idExperiment)}}",
			    dataType: 'json',
			    success: function(data) {
			    	$('#progress_num_jobs').html(data['num_jobs']);
			    	$('#progress_num_active').html(data['num_jobs_active']);
			    	$('#progress_num_active_perc').html(perc(data['num_jobs_active'],data['num_jobs']).toFixed(1) + ' %');
			    	$('#progress_num_finished').html(data['num_jobs_finished']);
			    	$('#progress_num_finished_perc').html(perc(data['num_jobs_finished'],data['num_jobs_active']).toFixed(1) + ' %');
			    	$('#progress_num_crashed').html(data['num_jobs_error']);
			    	$('#progress_num_crashed_perc').html(perc(data['num_jobs_error'],data['num_jobs_active']).toFixed(1) + ' %');
			    	$('#progress_num_running').html(data['num_jobs_running']);
			    	$('#progress_num_running_perc').html(perc(data['num_jobs_running'],data['num_jobs_active']).toFixed(1) + ' %');
			    	$('#progress_num_not_started').html(data['num_jobs_not_started']);
			    	$('#progress_num_not_started_perc').html(perc(data['num_jobs_not_started'],data['num_jobs_active']).toFixed(1) + ' %');
			    	if (data['eta'] == '0:00:00') $('#progress_eta').html('finished');
			    	else $('#progress_eta').html(data['eta']);
			    }
			});
    	});
        /* ]]> */
    </script>
{% endblock %}
{% block content %}
    <div class="navigation">
        Â» <a href="{{url_for('frontend.experiments_index', database=database)}}">Experiments</a> ::
        {{experiment.name}}
    </div>
    <h1>{{experiment.name}}</h1>
    <table style="float: left; margin-right: 50px;" border="0">
        <tr><td>Date:</td><td style="padding-left: 5px">{{experiment.date|datetimeformat('%d %B %Y')}}</td></tr>
        <tr><td>Description:</td><td style="padding-left: 5px">{{experiment.description if experiment.description else "no description"}}</td></tr>
        <tr><td>Timeout (sec):</td><td style="padding-left: 5px">{{experiment.CPUTimeLimit if experiment.CPUTimeLimit != -1 else '-'}}</td></tr>
        <tr><td>Max memory (MB):</td><td style="padding-left: 5px">{{experiment.memoryLimit if experiment.memoryLimit != -1 else '-'}}</td></tr>
        <tr><td>Wall clock time limit (sec):</td><td style="padding-left: 5px">{{experiment.wallClockTimeLimit if experiment.wallClockTimeLimit != -1 else '-'}}</td></tr>
        <tr><td>Stack size limit (MB):</td><td style="padding-left: 5px">{{experiment.stackSizeLimit if experiment.stackSizeLimit != -1 else '-'}}</td></tr>
        <tr><td>Output size limit (MB):</td><td style="padding-left: 5px">{{experiment.outputSizeLimit if experiment.outputSizeLimit != -1 else '-'}}</td></tr>
    </table>
    <table border="0">
        <tr><td>Jobs:</td><td colspan="2" style="padding-left: 5px" id="progress_num_jobs"><img src="{{url_for('static', filename='img/ajax-loader.gif')}}" /></td></tr>
        <tr><td>Active:</td><td style="padding-left: 5px; padding-right: 10px;" id="progress_num_active"></td><td id="progress_num_active_perc"></td></tr>
        <tr><td>Finished:</td><td style="padding-left: 5px" id="progress_num_finished"></td><td id="progress_num_finished_perc"></td></tr>
        <tr><td>Not started:</td><td style="padding-left: 5px" id="progress_num_not_started"></td><td id="progress_num_not_started_perc"></td></tr>
        <tr><td>Running:</td><td style="padding-left: 5px" id="progress_num_running"></td><td id="progress_num_running_perc"></td></tr>
        <tr><td>Crashed:</td><td style="padding-left: 5px" id="progress_num_crashed"></td><td id="progress_num_crashed_perc"></td></tr>
        <tr><td>ETA</td><td colspan="2" style="padding-left: 5px" id="progress_eta"></td></tr>
    </table>
    {% if not session.admin and db.is_competition() and db.competition_phase() in OWN_RESULTS %}
    <div style="clear:both; margin: 5px; font-weight: bold;"><img alt="Info" title="Info" src="{{url_for('static', filename='img/info.png')}}" /> While the competition isn't finished, you are only able to see your own solvers.</div>
    {% endif %}

    {% if not db.is_competition() or db.competition_phase() in ALL_RESULTS.union(OWN_RESULTS) %}
    <h2 style="clear:both;">Progress</h2>
    <a href="{{url_for('frontend.experiment_progress', database=database, experiment_id=experiment.idExperiment)}}">Live information about experiment progress</a><br/>
    {% endif %}

    <h2>Information about solvers and instances</h2>
    {% if not db.is_competition() or db.competition_phase() in ALL_RESULTS.union(OWN_RESULTS) %}
    <a href="{{url_for('frontend.experiment_solver_configurations', database=database, experiment_id=experiment.idExperiment)}}">List of solver configurations used</a><br/>
    {% endif %}
    <a href="{{url_for('frontend.experiment_instances', database=database, experiment_id=experiment.idExperiment)}}">List of instances used</a><br/>

    {% if not db.is_competition() or db.competition_phase() in ALL_RESULTS.union(OWN_RESULTS) %}
    <h2>Results</h2>
    <a href="{{url_for('frontend.experiment_results', database=database, experiment_id=experiment.idExperiment)}}">By solver configuration and instance</a> (runs accumulated)<br/>
    <a href="{{ url_for('frontend.experiment_results_by_solver', database=database, experiment_id=experiment.idExperiment) }}">By solver configuration</a><br/>
    <a href="{{ url_for('frontend.experiment_results_by_instance', database=database, experiment_id=experiment.idExperiment) }}">By instance</a><br/>
    <a href="{{ url_for('frontend.unsolved_instances', database=database, experiment_id=experiment.idExperiment) }}">Unsolved instances</a>
    {% endif %}

    <h2>Analysis</h2>
    {% if not db.is_competition() or db.competition_phase() in ANALYSIS2 %}
    <a href="{{url_for('analysis.box_plots', database=database, experiment_id=experiment.idExperiment)}}">Box plots - Box plots of the results of solvers on instances</a><br/>
    <a href="{{url_for('analysis.scatter_2solver_1property', database=database, experiment_id=experiment.idExperiment)}}">Scatter plot - One result property of two solvers (e.g. CPU time vs. CPU time)</a><br/>
    <a href="{{url_for('analysis.scatter_1solver_result_vs_result_property', database=database, experiment_id=experiment.idExperiment)}}">Scatter plot - Two result properties of a solver (e.g. CPU time vs. Memory)</a><br/>
    <a href="{{url_for('analysis.scatter_1solver_instance_vs_result_property', database=database, experiment_id=experiment.idExperiment)}}">Scatter plot - Result property against instance property (e.g. CPU Time against Number of Atoms)</a><br/>
    {% if not db.is_competition() or db.competition_phase() in ANALYSIS1 %}
    <a href="{{url_for('analysis.cactus_plot', database=database, experiment_id=experiment.idExperiment)}}">Cactus plot - Number of solved instances within a given amount of a property (e.g. time, memory, ...)</a><br/>
    {% endif %}
    {% if experiment.get_num_runs(db) > 1 %}
        <a href="{{url_for('analysis.property_distribution', database=database, experiment_id=experiment.idExperiment)}}">Result Property Distribution plot - Distribution and Kernel Density Estimation</a><br/>
        <a href="{{url_for('analysis.result_property_comparison', database=database, experiment_id=experiment.idExperiment)}}">Property distribution comparison of two solvers on an instance</a><br/>
        <a href="{{url_for('analysis.property_distributions', database=database, experiment_id=experiment.idExperiment)}}">Property distributions of solvers on an instance</a><br/>
        <a href="{{url_for('analysis.probabilistic_domination', database=database, experiment_id=experiment.idExperiment)}}">Analysis - Probabilistic Domination of solvers on the instances</a><br/>
    {% endif %}
    {% endif %}


    {% if not db.is_competition() or db.competition_phase() in RANKING %}
    <h2>Ranking</h2>
    <a href="{{url_for('analysis.solver_ranking', database=database, experiment_id=experiment.idExperiment)}}">Ranking by number of successful runs</a><br/>
    {% endif %}

{% endblock %}
