{% extends "base.html" %}
{% block title %}{{experiment.name}} Experiment{% endblock %}
{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="/static/css/datatable.css" type="text/css" />
    <script src="/static/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="/static/js/jquery.timers-1.2.js" type="text/javascript"></script>
    <script src="/static/js/jquery.dataTables.ajaxReloadPlugin.js" type="text/javascript"></script>
    <script type="text/javascript">
        /* <![CDATA[ */
        $.fn.dataTableExt.afnSortData['job-status'] = function  ( oSettings, iColumn )
        {
            var aData = [];
            $('td:eq('+iColumn+')', oSettings.oApi._fnGetTrNodes(oSettings)).each(function() {
                var v = $(this).html()
                if (v == 'error') aData.push("Aerror");
                else if (v == 'not started') aData.push("Bnot started");
                else if (v == 'running') aData.push("Crunning");
                else if (v == 'finished') aData.push("Dfinished");
                else if (v == 'terminated by ulimit') aData.push("Eterminated by ulimit");
            });
            return aData;
        }
        $(document).ready(function(){
            var JOB_STATUS_COLOR = {
                'error':            'red',
                'not started':      '#4169E1',
                'running':          'orange',
                'finished':         '#00CC33',
                'terminated by ulimit': '#00CC33',
            };

            oTable = $('#table_jobs').dataTable({
                "bPaginate": false,
                "oLanguage": {
                    "sZeroRecords": "No matching results"
                },
                "bAutoWidth": false,
                "bStateSave": true,
                "bProcessing": true,
                "sAjaxSource": "{{url_for('experiment_progress_ajax', database=database, experiment_id=experiment.idExperiment)}}",
		"fnRowCallback": function( nRow, aData, iDisplayIndex ) {
                    $('td:eq(0)', nRow).html('<a style="color: black;" href="/{{database}}/experiment/{{experiment.idExperiment}}/result/'+aData[0]+'">'+aData[0]+'</a>');
                    $(nRow).attr("bgcolor", JOB_STATUS_COLOR[$('td:eq(7)', nRow).html()]);
                    return nRow;
		},
                "aoColumns": [null, null, null, null, null, null, null, {"sSortDataType": "job-status"}]
            });

            $('#table_jobs_filter').append('<img id="img_clear" style="margin-left: 3px; margin-top: 3px;" src="/static/img/clear.png" title="Clear"/>');

            $('#img_clear').click(function() {
                if ($('#table_jobs_filter input').val() != "") {
                    $('#table_jobs_filter input').val('').keyup();
                }
            });

            $('#refresh').click(function() {
                oTable.fnReloadAjax();
                return false;
            });

            $('#refresh_interval').change(function() {
                $(this).stopTime();
                var v = $(this).val()
                if (v != '-') {
                    $(this).everyTime(v * 1000, function() {
                        $("body").css("cursor", "progress");
                        oTable.fnReloadAjax(null, function() {
                            $("body").css("cursor", "auto");
                        });
                    });
                }
            });

            $(document).keydown(function(e)
            {
                if (e.which == 116) // override F5 action to ajax reload instead of browser refresh
                {
                    $("body").css("cursor", "progress");
                    oTable.fnReloadAjax(null, function() {
                        $("body").css("cursor", "auto");
                    });
                    return false;
                }
            });
        });
        /* ]]> */
    </script>
{% endblock %}
{% block content %}
    <div class="navigation">
        Â» <a href="{{url_for('experiments_index', database=database)}}">Experiments</a> ::
        <a href="{{url_for('experiment', database=database, experiment_id=experiment.idExperiment)}}">{{experiment.name}}</a> ::
        Progress
    </div>
    <h2>Experiment progress</h2>
    <div style="margin-bottom: 10px;">
        The table below shows an overview of the individual benchmarks that are performed in this experiment. An experiment can be described as the cartesian product
        of a set of solvers, a set of instances and an integer number of runs n (labeled 0 through n - 1) of one particular solver on an instance.
        In this table a row represents one element of this cartesian product.<br/>
        If you click on the ID of a job in the first column you'll get to a page with more detailed information about the job including output of the solver once the job is finished.<br/>
        <br/>
        Notice that the F5 key was overriden on this page to use Ajax to refresh the table data without having to reload the whole page. You can also use the following link or set a periodic refresh interval:
    </div>

    <a id="refresh" href="#">Refresh Data</a> <strong>Refresh Interval:</strong>
    <select id="refresh_interval"><option value="-" selected="selected">-</option><option value="2">2s</option><option value="5">5s</option><option value="10">10s</option><option value="30">30s</option></select>
    <div style="max-width: 98%">
    <table id="table_jobs" class="display">
        <thead>
            <tr>
                <th>ID</th>
                <th>Solver</th>
                <th>Parameters</th>
                <th>Instance</th>
                <th>Run</th>
                <th>Time</th>
                <th>Seed</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <tr><td colspan="8">this table requires JavaScript to be enabled</td></tr>
        </tbody>
    </table>
    </div>

{% endblock %}